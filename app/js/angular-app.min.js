"use strict";var theatreApp=angular.module("theatre",["ui.router","pascalprecht.translate","theatreServices","theatreControllers","theatreRoutes","ngCookies","theatreDirectives","darthwade.dwLoading","infinite-scroll"]);theatreApp.run(["$rootScope","$state","$stateParams","$translate",function(e,t,r,o){e.$state=t,e.$stateParams=r,e.$on("$stateChangeStart",function(e,t,r){o.use(r.locale)})}]),theatreApp.config(["$translateProvider","$httpProvider",function(e,t){e.useStaticFilesLoader({prefix:"translating/lang_",suffix:".json"}),e.preferredLanguage("uk"),e.fallbackLanguage("uk"),t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",t.defaults.transformRequest=function(e){return angular.isObject(e)&&"[object File]"!==String(e)?angular.toParam(e):e}}]),function(){function e(t,r){var o,a,n=[];for(a in t)o=t[a],a=r?r+"["+a+"]":a,o=null===o?encodeURIComponent(a)+"=":"object"!=typeof o?encodeURIComponent(a)+"="+encodeURIComponent(o):e(o,a),n.push(o);return n.join("&")}angular.extend(angular,{toParam:e})}(),angular.module("theatreRoutes",["ui.router","theatreControllers"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,r){t.otherwise("/uk/"),e.state("app",{"abstract":!0,url:"/{locale}",template:"<ui-view/>"}).state("app.home",{url:"/",templateUrl:"views/HomePage/home.html",controller:"HomeCtrl"}).state("app.poster",{url:"/poster",templateUrl:"views/Poster/poster.html",controller:"PosterCtrl"}).state("app.repertoire",{url:"/repertoire",templateUrl:"views/Repertoire/repertoire.html",controller:"RepertoireCtrl"}).state("app.singlePerformance",{url:"/performance/:slug",templateUrl:"views/Performance/performance.html",controller:"SinglePerformanceCtrl"}).state("app.news",{url:"/news",templateUrl:"views/News/news.html",controller:"NewsCtrl"}).state("app.newsDetail",{url:"/news/:id",templateUrl:"views/News/detail.html",controller:"NewsDetailCtrl"}).state("app.about",{url:"/about",templateUrl:"views/About/about.html",controller:"AboutCtrl"}).state("app.persons",{url:"/persons",templateUrl:"views/Persons/persons.html",controller:"PersonsCtrl"}).state("app.personDetails",{url:"/persons/:id",templateUrl:"views/Persons/details.html",controller:"PersonsDetailCtrl"}).state("app.contacts",{url:"/contacts",templateUrl:"views/Contacts/contacts.html",controller:"ContactsCtrl"}).state("app.photos",{url:"/photos",templateUrl:"views/PhotoArchive/photoarchive.html",controller:"PhotoArchiveCtrl"}).state("app.videos",{url:"/videos",templateUrl:"views/VideoArchive/videoarchive.html",controller:"VideoArchiveCtrl"}).state("app.board",{url:"/board",templateUrl:"views/Static/board.html"}).state("app.partners",{url:"/partners",templateUrl:"views/Static/partners.html"}).state("app.fest",{url:"/festivals",templateUrl:"views/Festivals/festivals.html"}),r.html5Mode({enabled:!0,requireBase:!1})}]),angular.module("about",["angular-timeline"]).controller("AboutCtrl",["$scope","$http",function(e,t){e.historyStore=[],e.busy=!1,e.minDecade=1980,e.currentDecade=2010,e.getHistory=function(r){t.get("/backend/about/"+r+".json").success(function(t){e.historyStore=e.historyStore.concat(t)}).error(function(e){console.log(e)})},e.loadHistory=function(){1==e.busy||e.currentDecade<=e.minDecade||(e.busy=!0,e.getHistory(e.currentDecade),e.currentDecade-=10,e.busy=!1)}}]),angular.module("photoArchive",[]).controller("PhotoArchiveCtrl",["$scope",function(){}]),angular.module("videoArchive",[]).controller("VideoArchiveCtrl",["$scope",function(){}]),angular.module("contacts",[]).controller("ContactsCtrl",["$scope",function(e){e.info="Hello from contacts controller"}]),angular.module("home",[]).controller("HomeCtrl",["$scope","apiGet",function(e,t){t("posts.json?limit=3").success(function(t,r){200===r&&(e.news=t.posts)}).error(function(t){e.error=t})}]).controller("HomepageCarousel",["$scope","apiGet","dateConvert",function(e,t,r){function o(t){e.activeSlideIndex=t}e.slidesInfoArray=[],t("performanceevents.json?fromDate=today&limit=5").success(function(t,a){200===a&&(e.slides=t.performance_events,e.slidesDate=r.perfDate,o(0),e.selectSlide=o)}).error(function(t){e.error=t})}]),angular.module("news",[]).controller("NewsCtrl",["$scope","apiGet",function(e,t){function r(r){t("posts.json?limit="+e.perPage+"&page="+r).success(function(t,r){200===r&&(e.news=t.posts,e.total=t.total_count)}).error(function(e){console.log(e)})}e.news=[],e.posters=[],e.perPage=4,e.total=0,e.nextPage=function(e){r(e)},r(1)}]).controller("NewsDetailCtrl",["$scope","apiGet","$stateParams",function(e,t,r){function o(r){t("posts/"+r).success(function(t,r){200===r&&(e.news=t,e.title=t.title)}).error(function(e){console.log(e)})}e.title="",e.news={},o(r.id)}]),angular.module("person",["ui.bootstrap"]).controller("PersonsCtrl",["$scope","personsService","apiGet",function(e,t){function r(r){t.getAllPersons(r,e.peronsPerPage).then(function(t){e.persons=e.persons.concat(t.employees),e.pagesCount=t.page_count,e.busy=!1})}e.persons=[],e.personsTotal=0,e.peronsPerPage=20,e.currentPage=1,e.busy=!1,e.loadPersons=function(){1==e.busy||e.currentPage>=e.pagesCount||(e.busy=!0,r(e.currentPage++))}}]).controller("PersonsDetailCtrl",["$scope","personsService","$stateParams",function(e,t,r){e.promise=t.getPerson(r.id).then(function(t){return e.person=t,t})}]),angular.module("poster",[]).controller("PosterCtrl",["$scope","apiGet","$q",function(){}]),angular.module("repertoire",[]).controller("RepertoireCtrl",["$scope","apiGet",function(e,t){function r(r){t("performances?limit="+e.itemPerPage+"&page="+r).success(function(t){e.repertoire=t.performances,e.totalItems=t.page_count*e.itemPerPage}).error(function(t){e.error=t})}e.itemPerPage=8,r(1),e.setPage=function(t){t=e.currentPage,r(t)},e.maxSize=5}]),angular.module("singlePerf",["ui.bootstrap"]).controller("SinglePerformanceCtrl",["$scope","$q","apiGet","$stateParams","dateConvert",function(e,t,r,o,a){r("performances/"+o.slug).success(function(t){e.performance=t}).error(function(t){e.error=t}),r("performanceevents.json?fromDate=today&limit=5&performance="+o.slug).success(function(t){e.dates=[],e.performanceEvents=t.performance_events,e.performanceEvents.forEach(function(t,r){e.dates[r]=a.perfDate(t.date_time)})}).error(function(t){e.error=t}),r("performances/"+o.slug+"/roles").success(function(t){e.roles=t}).error(function(t){e.error=t})}]).controller("PerfTabsCtrl",["$scope","$window",function(){}]).controller("ImageCarouselCtrl",["$scope",function(e){e.myInterval=5e3;var t=e.slides=[];e.addSlide=function(){var e=600+t.length+1;t.push({source:"http://placekitten.com/"+e+"/300",text:["More","Extra","Lots of","Surplus"][t.length%4]+" "+["Cats","Kittys","Felines","Cutes"][t.length%4]})};for(var r=0;10>r;r++)e.addSlide()}]);var theatreControllers=angular.module("theatreControllers",["about","contacts","home","news","person","poster","repertoire","singlePerf","videoArchive","photoArchive"]);theatreControllers.controller("translateCtrl",["$scope","$translate","$stateParams","$state",function(e,t,r,o){e.chLocale=function(){var e="";e="uk"===r.locale?"en":"uk",t.use(e),r.locale=e,o.reload()}}]),angular.module("newsRightSidebar",[]).directive("newsBlock",["apiGet","$document",function(e,t){return{restrict:"E",templateUrl:"views/News/rightSidebarInNews.html",scope:{},link:function(r,o){r.scrollTop=0,t.on("scroll",function(){if(window.pageYOffset||document.documentElement.scrollTop){var e=0;if(e=window.pageYOffset||document.documentElement.scrollTop,e>140){var t=20;o.css({top:t,position:"fixed"})}else o.css({top:"auto",position:"relative"})}}),r.posters=[];var a=moment(),n=a.add(4,"days"),s="performanceevents.json?fromDate=today&toDate="+n.format("DD-MM-YYYY")+"&limit=4";e(s).success(function(e,t){200===t&&(r.posters=e.performance_events)}).error(function(e){console.log(e)})}}}]),angular.module("posterDirectives",[]).directive("thPosterCalendar",["apiGet","$compile","$stateParams",function(e,t,r){return{restrict:"E",templateUrl:"views/Poster/Directives/thCalendarView.html",scope:{monthl:"=",yearl:"="},link:function(o,a){function n(e,t,o){var a="";return e.forEach(function(e){parseInt(e.day)===o&&parseInt(e.month)===t+1&&(a=a+"<img ng-src='"+e.performance.mainPicture.performance_big.url+"' ><a href='"+r.locale+"/performance/"+e.performance.slug+"' title='"+e.performance.description+"' class='th-calendar-poster-link'><span class='th-calendar-poster-title'>"+e.performance.title+"</span><span class='th-calendar-poster-time'>"+e.time+"</span></a>")}),a}function s(e,t,r){var o=new Date(t,e+1,0).getDate(),a=new Date(t,e,o),s=new Date(a.getFullYear(),a.getMonth(),o).getDay(),l=new Date(a.getFullYear(),a.getMonth(),1).getDay(),c='<table id="calendar" class="theatre-poster-calendar"><thead><tr><th>{{"day.Monday"|translate}}<th>{{"day.Tuesday"|translate}}<th>{{"day.Wednesday"|translate}}<th>{{"day.Thursday"|translate}}<th>{{"day.Friday"|translate}}<th>{{"day.Saturday"|translate}}<th>{{"day.Sunday"|translate}}<tbody>',i="<tr>",u="</table>",p=0;i=c+i;var m=new Date(t,e,0).getDate();if(0!=l){var p=0,d=m-(l-2);for(p=1,d;l>p;p++,d++)i+='<td class="prev-month-day"><span class="th-calendar-date-before">'+d+"</span>"+n(r,e-1,d)}else{var p=0,d=m-5;for(p=0,d;6>p;p++,d++)i+='<td class="prev-month-day"><span class="th-calendar-date-before">'+d+"</span>"+n(r,e-1,d)}var p=0;for(p=1;o>=p;p++)i+=p==(new Date).getDate()&&a.getFullYear()==(new Date).getFullYear()&&a.getMonth()==(new Date).getMonth()?'<td class="this-month-day today"><span class="th-calendar-date">'+p+"</span>"+n(r,e,p):'<td class="this-month-day"><span class="th-calendar-date">'+p+"</span>"+n(r,e,p),0==new Date(a.getFullYear(),a.getMonth(),p).getDay()&&(i+="<tr>");var p=0,f=0;if(0!=s)for(p=s;7>p;p++)i+='<td class="next-month-day"><span class="th-calendar-date-after">'+ ++f+"</span>"+n(r,e+1,f);return i+=u}o.$watch("monthl",function(){var r=0,n=0;r=o.yearl,n=o.monthl;var l=r,c=n,i=moment(l+"-"+(c+1),"YYYY-M").add(1,"months").add(7,"days"),u=moment(l+"-"+(c+1),"YYYY-M").subtract(7,"days"),p="performanceevents.json?fromDate="+u.format("DD-MM-YYYY")+"&toDate="+i.format("DD-MM-YYYY");e(p).success(function(e,r){if(200==r){var n=s(o.monthl,o.yearl,e.performance_events),l=angular.element(n);t(l)(o),a.html(l)}else{var n=s(o.monthl,o.yearl,[]),l=angular.element(n);t(l)(o),a.html(l),console.log("bad request")}})},!0)}}}]).directive("swCalendarDate",[function(){return{restrict:"E",templateUrl:"views/Poster/Directives/switchCalDateView.html",scope:{},link:function(e){var t,r=["month.Jan","month.Feb","month.Mar","month.Apr","month.May","month.Jun","month.Jul","month.Aug","month.Sept","month.Oct","month.Nov","month.Dec"],o=new Date;e.now=o,e.year=o.getFullYear(),e.month=o.getMonth(),t=e.month,e.monthName=r[t],e.prevMonth=function(){t=e.month,e.now=new Date(e.year,t-1),e.year=e.now.getFullYear(),e.month=e.now.getMonth(),t=e.month,e.monthName=r[t]},e.nextMonth=function(){t=e.month,e.now=new Date(e.year,t+1),e.year=e.now.getFullYear(),e.month=e.now.getMonth(),t=e.month,e.monthName=r[t]}}}}]),angular.module("sideMenuDirective",[]).directive("asideMenu",function(){return{restrict:"E",templateUrl:"views/shared/Directives/asideMenu.html",scope:{},replace:!0}}),angular.module("theatreDirectives",["posterDirectives","sideMenuDirective","newsRightSidebar"]);var theatreServices=angular.module("theatreServices",[]);theatreServices.constant("api_url","http://api.theatre.pp.ua/").factory("apiPost",["$http","api_url","$stateParams",function(e,t,r){return function(o,a){var n={method:"GET",url:t+o,headers:{locale:r.locale},data:a};return e(n).success(function(e){return e||[]}).error(function(e){return e})}}]).factory("apiGet",["$http","api_url","$stateParams","$loading",function(e,t,r,o){return function(a){var n={method:"GET",url:t+a,params:{locale:r.locale}};return o.start("spiner"),e(n).success(function(e){return o.finish("spiner"),e||[]}).error(function(e){return o.finish("spiner"),e})}}]).factory("personsService",["$http","apiGet","$q",function(e,t,r){return{getAllPersons:function(e,o){var a=r.defer();return t("employees?limit="+o+"&page="+e).success(function(e){a.resolve(e)}).error(function(e,t){a.reject(t)}),a.promise},getPerson:function(e){var o=r.defer();return t("employees/"+e).success(function(e){o.resolve(e)}).error(function(e,t){o.reject(t)}),o.promise}}}]).factory("dateConvert",function(){return{perfDate:function(e){var t=moment(e),r=["weekDay.Sunday","weekDay.Monday","weekDay.Tuesday","weekDay.Wednesday","weekDay.Thursday","weekDay.Friday","weekDay.Saturday"],o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"];return{weekDay:r[t.format("d")],day:t.format("D"),month:o[t.format("M")-1],time:t.format("H:mm")}}}});